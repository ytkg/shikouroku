# プロダクト機能拡張ロードマップ（継続利用率優先）v1

更新日: 2026-02-23
対象: `apps/web` / `apps/api`

## 1. 目的

- 現行機能を前提に、継続利用率を最優先で機能拡張する。
- 実装着手前に、優先順位・仕様方針・受け入れ基準を明文化する。

## 2. 現状機能サマリー

- 認証
  - `POST /api/login`, `POST /api/logout`
  - 未認証時のガードとログイン遷移
- 嗜好（Entity）
  - 一覧表示、検索、種別フィルタ、気になるフィルタ、ページング
  - 詳細表示、新規作成、編集
- タグ
  - 一覧取得、作成、削除
- 関連嗜好
  - 取得、追加、解除
- 画像
  - 一覧取得、アップロード、削除、並び替え、ファイル配信
  - 新規/編集画面で失敗画像の再試行
- 運用機能
  - 画像削除失敗時の補償キュー
  - 手動実行APIとcron実行

## 3. 優先順位の前提

- 優先軸は「継続利用率」。
- まず「再訪したくなる体験」を作り、その次に「長期運用の劣化対策」を実施する。

## 4. 追加機能提案（優先順）

### 4.1 P0: 振り返りホーム

- 目的
  - ログイン直後に「次に何をするか」が分かる状態を作る。
- 仕様
  - ホーム上部に以下を表示する。
  - 最近追加
  - 最近更新
  - 気になる未解消
  - 前回ログイン以降の変化件数を表示する。
- 受け入れ基準
  - ログイン後、一覧の受動閲覧だけでなく詳細遷移や編集へつながる。

### 4.2 P0: リマインド（見返し日）

- 目的
  - 記録を単発入力で終わらせず、再編集サイクルを作る。
- 仕様
  - entityに見返し日（`review_at`）を設定可能にする。
  - 当日以前の見返し日をホームに期限到来として表示する。
  - 期限到来項目から詳細画面へ遷移できる。
- 受け入れ基準
  - 見返し日が到来した項目をホームで確実に確認できる。

### 4.3 P1: アーカイブ/削除

- 目的
  - データ増加時も一覧の視認性を維持する。
- 仕様
  - まず論理アーカイブ（復元可能）を導入する。
  - 物理削除は管理操作として分離する。
- 受け入れ基準
  - 通常一覧からは除外され、アーカイブ表示時のみ参照できる。

### 4.4 P1: タグ運用強化（リネーム/マージ）

- 目的
  - 長期運用で発生するタグ重複・表記ゆれを解消する。
- 仕様
  - タグ名変更（rename）
  - タグ統合（merge）
- 受け入れ基準
  - マージ後に関連付けが一貫して置換され、重複が残らない。

### 4.5 P2: エクスポート

- 目的
  - 蓄積データの可搬性を確保し、利用継続の心理的障壁を下げる。
- 仕様
  - JSONエクスポートを提供する。
  - 対象は entity, tags, relations, images metadata とする。
- 受け入れ基準
  - エクスポート結果だけでデータ構造を再現できる。

## 5. API変更案（実装候補）

- dashboard
  - `GET /api/dashboard/summary`
  - 返却例: `recentAdded`, `recentUpdated`, `dueItems`, `sinceLastLoginCount`
- entities
  - `PATCH /api/entities/:id` へ `reviewAt`, `archivedAt` を追加
  - `GET /api/entities` へ `dueOnly`, `archived` フィルタを追加
- tags
  - `PATCH /api/tags/:id`（rename）
  - `POST /api/tags/:id/merge`（merge）
- export
  - `GET /api/export.json`（認証必須）

## 6. DB変更案（実装候補）

- `entities` テーブルへ以下を追加する。
  - `review_at`（TEXT, nullable）
  - `archived_at`（TEXT, nullable）
  - `last_viewed_at`（TEXT, nullable, 任意）
  - 期限到来・アーカイブ表示向けにインデックスを追加する。

## 7. テスト方針

- バックエンド
  - `dashboard summary` の集計ロジック検証
  - `review_at` / `archived_at` のクエリ条件検証
  - タグrename/merge時の整合性検証
  - exportレスポンススキーマ検証
- フロントエンド
  - ホームでの振り返り表示（空/通常/大量）
  - 期限到来カードから詳細遷移
  - アーカイブ表示切替
  - タグリネーム/マージUIの成功・失敗

## 8. 実装順序

1. 振り返りホーム（P0）
2. リマインド（P0）
3. アーカイブ/削除（P1）
4. タグ運用強化（P1）
5. エクスポート（P2）

## 9. 計測KPI

- 7日継続率
- 1セッションあたりの詳細遷移数
- 週次再編集率
- 期限到来項目の消化率
- タグ重複率

## 10. 前提と非スコープ

- 本ドキュメントは機能提案と実装方針の整理であり、実装は未着手。
- 通知はまずアプリ内表示のみとし、外部通知（メール/Push）は対象外。
- インポート機能は別フェーズで検討する。
